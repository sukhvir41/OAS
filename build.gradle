buildscript {
	repositories {
		jcenter()
	}

	dependencies {
		classpath 'com.bmuschko:gradle-cargo-plugin:2.4'
		classpath "org.hibernate:hibernate-gradle-plugin:5.4.1.Final"
	}
}

plugins {
	id 'war'
	id 'net.ltgt.apt' version '0.10'
	id 'io.franzbecker.gradle-lombok' version '1.14'
	id "com.scalified.plugins.gradle.metamodel" version "0.0.1"

}

apply plugin: 'com.bmuschko.cargo'
apply plugin: 'org.hibernate.orm'


sourceCompatibility = '1.8'
[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'


if ( !hasProperty( 'mainClass' ) ) {
	ext.mainClass = ''
}

repositories {
	mavenCentral()
	jcenter()
}

hibernate {
	enhance {
		enableLazyInitialization = true
		enableDirtyTracking = true
		enableAssociationManagement = true
	}
}

dependencies {
	cargo 'org.codehaus.cargo:cargo-core-uberjar:1.6.9',
		  'org.codehaus.cargo:cargo-ant:1.6.9'

	providedCompile 'javax.servlet:javax.servlet-api:4.0.0'

	compileOnly 'org.projectlombok:lombok:1.18.2'
	apt "org.projectlombok:lombok:1.18.2"

	compile group: 'org.postgresql', name: 'postgresql', version: '42.2.5'
	compile group: 'javax.mail', name: 'javax.mail-api', version: '1.6.1'
	compile group: 'com.google.code.gson', name: 'gson', version: '2.8.5'
	compile group: 'org.hibernate', name: 'hibernate-core', version: '5.4.1.Final'
	compile 'javax.websocket:javax.websocket-api:1.1'
	compile group: 'javax.servlet', name: 'jstl', version: '1.2'
	compile 'org.apache.commons:commons-lang3:3.8.1'
	compile 'com.github.oshi:oshi-core:3.13.0'
	compile 'org.apache.poi:poi:4.0.1'
	compile 'org.jooq:jooq:3.11.10'
	compile 'org.jooq:jooq-meta:3.11.10'
	compile 'org.jooq:jooq-codegen:3.11.10'
	compile 'org.pcap4j:pcap4j-core:1.7.6'
	compile 'org.pcap4j:pcap4j-packetfactory-static:1.7.6'

	//compile fileTree(dir: 'libs', include: ['*.jar'])

	testCompile group: 'junit', name: 'junit', version: '4.10'
	testCompile 'org.mockito:mockito-core:2.7.19'
}

lombok {
	version = "1.16.20"
	sha256 = "c5178b18caaa1a15e17b99ba5e4023d2de2ebc18b58cde0f5a04ca4b31c10e6d"
}

cargo {
	containerId = 'tomcat9x'
	port = 8080

	deployable {
		context = '/OAS'
	}

	local {
		homeDir = file( 'C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0' )
		outputFile = file( 'output.log' )
	}
}


task runApplication() {
	dependsOn clean
	dependsOn build
	dependsOn cargoStopLocal
	dependsOn cargoRunLocal

	println( 'Done!!' )
}